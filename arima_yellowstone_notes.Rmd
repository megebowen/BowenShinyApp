---
title: "arima_notes"
author: "Meghan Bowen"
date: "2/20/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages}

library(tidyverse)
library(knitr)
library(lubridate)
library(tseries)
library(forecast)

```


```{r load_data_Yellowstone_yr}

yellowstone_vis_year <- read_csv("~/github/BowenShinyApp/Visitation_data/yellowstone_vis_year.csv")
yellowstone_vis_year <- yellowstone_vis_year[-1,]
colnames(yellowstone_vis_year) <- yellowstone_vis_year[1,]
yellowstone_vis_year <- yellowstone_vis_year[-1,]

#Explore yearly data
ggplot(yellowstone_vis_year, aes(x=Year, y=RecreationVisitors))+
  geom_point()


```

```{r clean_month}
##Need to clean the monthly data and make into tidy format

yellowstone_vis_month <- read_csv("~/github/BowenShinyApp/Visitation_Data/yellowstone_vis_month.csv") %>%
  select(-Textbox5)
yellowstone_vis_month$Year <- as.factor(yellowstone_vis_month$Year)

gather_up <- gather(yellowstone_vis_month, key = "Month", value = "VisitorCount", JAN:DEC)
#gather_up <- as.data.frame(gather_up)
gather_up$Month <- as.factor(gather_up$Month)

months <- factor(levels = c("JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"))
gather_up$Month <- fct_relevel(gather_up$Month, months)

gather_yellowstone <- gather_up[order(gather_up$Year),]
gather_yellowstone <- unite(gather_yellowstone,
                            Year_Month, c(Year, Month), remove = T)

```

```{r check_arima_assumptions}
#convert to timeseries data
ex_ts <- ts(gather_up$VisitorCount, frequency = 12, start = c(1979,1))

ex_ts <- na.remove(ex_ts)

plot(ex_ts)

#check decomposition
ex_decomp <- decompose(ex_ts)
plot(ex_decomp)

#check ACF
ex_acf <- acf(ex_ts)

```

```{r holt_winters}

#trying holt-winters first. apparently it didn't work

## channel_hw <- HoltWinters(ex_ts)

# ARIMA

channel_pdq <- auto.arima(ex_ts)
channel_pdq

# ARIMA predicted pdq: (0,1,1)(0,0,1)[11] 

channel_arima <- arima(ex_ts, order = c(0,1,1), seasonal = list(order = c(0,0,1)))
channel_arima

# Residuals. not looking great, but not completely not-normal ??

par(mfrow = c(1,2))
hist(channel_arima$residuals)
qqnorm(channel_arima$residuals)

# ARIMA Forecast: let's do 5 years (60 months)

channel_forecast <- forecast(channel_arima, h = 60)
plot(channel_forecast)

```

```{r predicted_visitation_plot}

channel_forecast_0 <- data.frame(channel_forecast)

# monthly data frame
month_seq <- seq(1,60)
channel_forecast_df <- data.frame(month_seq, channel_forecast_0)


ggplot(channel_forecast_df, aes(x=month_seq, y = Point.Forecast)) +
  geom_line()
```


